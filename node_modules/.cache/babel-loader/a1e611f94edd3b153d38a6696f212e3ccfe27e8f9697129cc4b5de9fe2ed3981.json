{"ast":null,"code":"import React,{useCallback,useEffect}from'react';import{useForm,Controller}from'react-hook-form';import{useNavigate}from'react-router-dom';import useWebSocket from'../../api';import{useAuth}from'../../contexts/AuthContext';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const LoginForm=_ref=>{let{api}=_ref;const{control,handleSubmit,getValues}=useForm();const navigate=useNavigate();const webScoket1=useWebSocket(process.env.REACT_APP_API_URL1);const webScoket2=useWebSocket(process.env.REACT_APP_API_URL2);const{login,setConnect,isServersConnected}=useAuth();const openNotificationWithIcon=useCallback((type,message,description)=>{api[type]({message,description});},[api]);const onSubmit=data=>{if(!data.username||!data.password){openNotificationWithIcon('error',\"Erro\",'Preencha todos os campos.');console.error('Preencha todos os campos.');return;}if(!webScoket1.checkConnection()){webScoket1.connectWebSocket();}if(!webScoket2.checkConnection()){webScoket2.connectWebSocket();}if(!webScoket1.checkConnection()&&!webScoket2.checkConnection()&&isServersConnected){setConnect(false);}else if((webScoket1.checkConnection()||webScoket2.checkConnection())&&!isServersConnected){setConnect(true);}webScoket1.send(\"/login \".concat(data.username,\" \").concat(data.password));webScoket2.send(\"/login \".concat(data.username,\" \").concat(data.password));};const handleWebSocketMessage=useCallback((message,username)=>{if(message.status==='success'){openNotificationWithIcon('success','Login Bem-Sucedido','Você fez login com sucesso!');login(username);navigate('/home');// Navega para a página inicial após login bem-sucedido\n}else if(message.status==='error'){openNotificationWithIcon('error','Erro',message.data);console.error(message);}},[navigate,openNotificationWithIcon,login]);useEffect(()=>{if(webScoket1.receivedMessages){handleWebSocketMessage(webScoket1.receivedMessages,getValues().username);}},[webScoket1.receivedMessages,handleWebSocketMessage,getValues]);useEffect(()=>{if(webScoket2.receivedMessages){handleWebSocketMessage(webScoket2.receivedMessages,getValues().username);}},[webScoket2.receivedMessages,handleWebSocketMessage,getValues]);return/*#__PURE__*/_jsx(\"div\",{className:\"flex items-center justify-center min-h-screen bg-lightGray\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"w-full max-w-md p-8 bg-white shadow-lg rounded-lg\",children:[/*#__PURE__*/_jsx(\"h2\",{className:\"text-2xl font-bold mb-6 text-center\",children:\"Login\"}),/*#__PURE__*/_jsxs(\"form\",{onSubmit:handleSubmit(onSubmit),children:[/*#__PURE__*/_jsxs(\"div\",{className:\"mb-4\",children:[/*#__PURE__*/_jsx(\"label\",{htmlFor:\"username\",className:\"block text-mediumGray mb-2\",children:\"Nome de usu\\xE1rio\"}),/*#__PURE__*/_jsx(Controller,{name:\"username\",control:control,defaultValue:\"\",render:_ref2=>{let{field}=_ref2;return/*#__PURE__*/_jsx(\"input\",{...field,className:\"w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary\",placeholder:\"Digite seu username\"});}})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"mb-4\",children:[/*#__PURE__*/_jsx(\"label\",{htmlFor:\"password\",className:\"block text-mediumGray mb-2\",children:\"Senha\"}),/*#__PURE__*/_jsx(Controller,{name:\"password\",control:control,defaultValue:\"\",render:_ref3=>{let{field}=_ref3;return/*#__PURE__*/_jsx(\"input\",{type:\"password\",...field,className:\"w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary\",placeholder:\"Digite sua senha\"});}})]}),/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsx(\"button\",{type:\"submit\",className:\"w-full px-4 py-2 bg-primary text-white rounded-lg hover:bg-green-500 focus:outline-none focus:ring-2 focus:ring-primary\",children:\"Login\"})}),/*#__PURE__*/_jsxs(\"div\",{className:\"mt-4 text-center\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"text-mediumGray\",children:\"N\\xE3o tem uma conta? \"}),/*#__PURE__*/_jsx(\"button\",{type:\"button\",className:\"text-primary hover:text-green-500 focus:outline-none focus:underline\",onClick:()=>navigate('/register'),children:\"Registrar-se\"})]})]})]})});};export default LoginForm;","map":{"version":3,"names":["React","useCallback","useEffect","useForm","Controller","useNavigate","useWebSocket","useAuth","jsx","_jsx","jsxs","_jsxs","LoginForm","_ref","api","control","handleSubmit","getValues","navigate","webScoket1","process","env","REACT_APP_API_URL1","webScoket2","REACT_APP_API_URL2","login","setConnect","isServersConnected","openNotificationWithIcon","type","message","description","onSubmit","data","username","password","console","error","checkConnection","connectWebSocket","send","concat","handleWebSocketMessage","status","receivedMessages","className","children","htmlFor","name","defaultValue","render","_ref2","field","placeholder","_ref3","onClick"],"sources":["/home/eduardo/repos/chat/chat-webapp/src/pages/Login/index.tsx"],"sourcesContent":["import React, { useCallback, useEffect } from 'react';\nimport { useForm, Controller } from 'react-hook-form';\nimport { useNavigate } from 'react-router-dom';\nimport useWebSocket from '../../api';\nimport { type NotificationInstance } from 'antd/es/notification/interface';\nimport { useAuth } from '../../contexts/AuthContext';\nimport { NotificationType } from '../../common/notificationType';\n\ninterface FormData {\n  username: string;\n  password: string;\n}\n\ninterface LoginFormProps {\n  api: NotificationInstance;\n}\n\nconst LoginForm: React.FC<LoginFormProps> = ({ api }) => {\n  const { control, handleSubmit, getValues } = useForm<FormData>();\n  const navigate = useNavigate();\n  const webScoket1= useWebSocket( process.env.REACT_APP_API_URL1 as string);\n  const webScoket2 = useWebSocket( process.env.REACT_APP_API_URL2 as string);\n  const { login, setConnect, isServersConnected } = useAuth();\n\n  const openNotificationWithIcon = useCallback(\n    (type: NotificationType, message: string, description: string) => {\n      api[type]({\n        message,\n        description,\n      });\n    },\n    [api]\n  );\n\n  const onSubmit = (data: FormData) => {\n    if (!data.username || !data.password) {\n      openNotificationWithIcon('error', \"Erro\", 'Preencha todos os campos.');\n      console.error('Preencha todos os campos.');\n      return;\n    }\n\n    if (!webScoket1.checkConnection()){\n      webScoket1.connectWebSocket();\n    }\n    if (!webScoket2.checkConnection()){\n      webScoket2.connectWebSocket();\n    }\n\n    if (!webScoket1.checkConnection() && !webScoket2.checkConnection() && isServersConnected) {\n      setConnect(false);\n    } else if ((webScoket1.checkConnection() || webScoket2.checkConnection()) && !isServersConnected) {\n      setConnect(true)\n    }\n    webScoket1.send(`/login ${data.username} ${data.password}`);\n    webScoket2.send(`/login ${data.username} ${data.password}`);\n  };\n\n  const handleWebSocketMessage = useCallback(\n    (message: any, username: string) => {\n      if (message.status === 'success') {\n        openNotificationWithIcon('success', 'Login Bem-Sucedido', 'Você fez login com sucesso!');\n        login(username);\n        navigate('/home'); // Navega para a página inicial após login bem-sucedido\n      } else if (message.status === 'error') {\n        openNotificationWithIcon('error', 'Erro', message.data);\n        console.error(message);\n      }\n    },\n    [navigate, openNotificationWithIcon, login]\n  );\n\n  useEffect(() => {\n    if (webScoket1.receivedMessages) {\n      handleWebSocketMessage(webScoket1.receivedMessages, getValues().username);\n    }\n  }, [webScoket1.receivedMessages, handleWebSocketMessage, getValues]);\n\n  useEffect(() => {\n    if (webScoket2.receivedMessages) {\n      handleWebSocketMessage(webScoket2.receivedMessages, getValues().username);\n    }\n  }, [webScoket2.receivedMessages, handleWebSocketMessage, getValues]);\n\n  return (\n    <div className=\"flex items-center justify-center min-h-screen bg-lightGray\">\n      <div className=\"w-full max-w-md p-8 bg-white shadow-lg rounded-lg\">\n        <h2 className=\"text-2xl font-bold mb-6 text-center\">Login</h2>\n        <form onSubmit={handleSubmit(onSubmit)}>\n          <div className=\"mb-4\">\n            <label htmlFor=\"username\" className=\"block text-mediumGray mb-2\">Nome de usuário</label>\n            <Controller\n              name=\"username\"\n              control={control}\n              defaultValue=\"\"\n              render={({ field }) => <input {...field} className=\"w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary\" placeholder=\"Digite seu username\" />}\n            />\n          </div>\n          <div className=\"mb-4\">\n            <label htmlFor=\"password\" className=\"block text-mediumGray mb-2\">Senha</label>\n            <Controller\n              name=\"password\"\n              control={control}\n              defaultValue=\"\"\n              render={({ field }) => <input type=\"password\" {...field} className=\"w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary\" placeholder=\"Digite sua senha\" />}\n            />\n          </div>\n          <div>\n            <button type=\"submit\" className=\"w-full px-4 py-2 bg-primary text-white rounded-lg hover:bg-green-500 focus:outline-none focus:ring-2 focus:ring-primary\">\n              Login\n            </button>\n          </div>\n          <div className=\"mt-4 text-center\">\n            <span className=\"text-mediumGray\">Não tem uma conta? </span>\n            <button\n              type=\"button\"\n              className=\"text-primary hover:text-green-500 focus:outline-none focus:underline\"\n              onClick={() => navigate('/register')}\n            >\n              Registrar-se\n            </button>\n          </div>\n        </form>\n      </div>\n    </div>\n  );\n};\n\nexport default LoginForm;\n"],"mappings":"AAAA,MAAO,CAAAA,KAAK,EAAIC,WAAW,CAAEC,SAAS,KAAQ,OAAO,CACrD,OAASC,OAAO,CAAEC,UAAU,KAAQ,iBAAiB,CACrD,OAASC,WAAW,KAAQ,kBAAkB,CAC9C,MAAO,CAAAC,YAAY,KAAM,WAAW,CAEpC,OAASC,OAAO,KAAQ,4BAA4B,CAAC,OAAAC,GAAA,IAAAC,IAAA,CAAAC,IAAA,IAAAC,KAAA,yBAYrD,KAAM,CAAAC,SAAmC,CAAGC,IAAA,EAAa,IAAZ,CAAEC,GAAI,CAAC,CAAAD,IAAA,CAClD,KAAM,CAAEE,OAAO,CAAEC,YAAY,CAAEC,SAAU,CAAC,CAAGd,OAAO,CAAW,CAAC,CAChE,KAAM,CAAAe,QAAQ,CAAGb,WAAW,CAAC,CAAC,CAC9B,KAAM,CAAAc,UAAU,CAAEb,YAAY,CAAEc,OAAO,CAACC,GAAG,CAACC,kBAA4B,CAAC,CACzE,KAAM,CAAAC,UAAU,CAAGjB,YAAY,CAAEc,OAAO,CAACC,GAAG,CAACG,kBAA4B,CAAC,CAC1E,KAAM,CAAEC,KAAK,CAAEC,UAAU,CAAEC,kBAAmB,CAAC,CAAGpB,OAAO,CAAC,CAAC,CAE3D,KAAM,CAAAqB,wBAAwB,CAAG3B,WAAW,CAC1C,CAAC4B,IAAsB,CAAEC,OAAe,CAAEC,WAAmB,GAAK,CAChEjB,GAAG,CAACe,IAAI,CAAC,CAAC,CACRC,OAAO,CACPC,WACF,CAAC,CAAC,CACJ,CAAC,CACD,CAACjB,GAAG,CACN,CAAC,CAED,KAAM,CAAAkB,QAAQ,CAAIC,IAAc,EAAK,CACnC,GAAI,CAACA,IAAI,CAACC,QAAQ,EAAI,CAACD,IAAI,CAACE,QAAQ,CAAE,CACpCP,wBAAwB,CAAC,OAAO,CAAE,MAAM,CAAE,2BAA2B,CAAC,CACtEQ,OAAO,CAACC,KAAK,CAAC,2BAA2B,CAAC,CAC1C,OACF,CAEA,GAAI,CAAClB,UAAU,CAACmB,eAAe,CAAC,CAAC,CAAC,CAChCnB,UAAU,CAACoB,gBAAgB,CAAC,CAAC,CAC/B,CACA,GAAI,CAAChB,UAAU,CAACe,eAAe,CAAC,CAAC,CAAC,CAChCf,UAAU,CAACgB,gBAAgB,CAAC,CAAC,CAC/B,CAEA,GAAI,CAACpB,UAAU,CAACmB,eAAe,CAAC,CAAC,EAAI,CAACf,UAAU,CAACe,eAAe,CAAC,CAAC,EAAIX,kBAAkB,CAAE,CACxFD,UAAU,CAAC,KAAK,CAAC,CACnB,CAAC,IAAM,IAAI,CAACP,UAAU,CAACmB,eAAe,CAAC,CAAC,EAAIf,UAAU,CAACe,eAAe,CAAC,CAAC,GAAK,CAACX,kBAAkB,CAAE,CAChGD,UAAU,CAAC,IAAI,CAAC,CAClB,CACAP,UAAU,CAACqB,IAAI,WAAAC,MAAA,CAAWR,IAAI,CAACC,QAAQ,MAAAO,MAAA,CAAIR,IAAI,CAACE,QAAQ,CAAE,CAAC,CAC3DZ,UAAU,CAACiB,IAAI,WAAAC,MAAA,CAAWR,IAAI,CAACC,QAAQ,MAAAO,MAAA,CAAIR,IAAI,CAACE,QAAQ,CAAE,CAAC,CAC7D,CAAC,CAED,KAAM,CAAAO,sBAAsB,CAAGzC,WAAW,CACxC,CAAC6B,OAAY,CAAEI,QAAgB,GAAK,CAClC,GAAIJ,OAAO,CAACa,MAAM,GAAK,SAAS,CAAE,CAChCf,wBAAwB,CAAC,SAAS,CAAE,oBAAoB,CAAE,6BAA6B,CAAC,CACxFH,KAAK,CAACS,QAAQ,CAAC,CACfhB,QAAQ,CAAC,OAAO,CAAC,CAAE;AACrB,CAAC,IAAM,IAAIY,OAAO,CAACa,MAAM,GAAK,OAAO,CAAE,CACrCf,wBAAwB,CAAC,OAAO,CAAE,MAAM,CAAEE,OAAO,CAACG,IAAI,CAAC,CACvDG,OAAO,CAACC,KAAK,CAACP,OAAO,CAAC,CACxB,CACF,CAAC,CACD,CAACZ,QAAQ,CAAEU,wBAAwB,CAAEH,KAAK,CAC5C,CAAC,CAEDvB,SAAS,CAAC,IAAM,CACd,GAAIiB,UAAU,CAACyB,gBAAgB,CAAE,CAC/BF,sBAAsB,CAACvB,UAAU,CAACyB,gBAAgB,CAAE3B,SAAS,CAAC,CAAC,CAACiB,QAAQ,CAAC,CAC3E,CACF,CAAC,CAAE,CAACf,UAAU,CAACyB,gBAAgB,CAAEF,sBAAsB,CAAEzB,SAAS,CAAC,CAAC,CAEpEf,SAAS,CAAC,IAAM,CACd,GAAIqB,UAAU,CAACqB,gBAAgB,CAAE,CAC/BF,sBAAsB,CAACnB,UAAU,CAACqB,gBAAgB,CAAE3B,SAAS,CAAC,CAAC,CAACiB,QAAQ,CAAC,CAC3E,CACF,CAAC,CAAE,CAACX,UAAU,CAACqB,gBAAgB,CAAEF,sBAAsB,CAAEzB,SAAS,CAAC,CAAC,CAEpE,mBACER,IAAA,QAAKoC,SAAS,CAAC,4DAA4D,CAAAC,QAAA,cACzEnC,KAAA,QAAKkC,SAAS,CAAC,mDAAmD,CAAAC,QAAA,eAChErC,IAAA,OAAIoC,SAAS,CAAC,qCAAqC,CAAAC,QAAA,CAAC,OAAK,CAAI,CAAC,cAC9DnC,KAAA,SAAMqB,QAAQ,CAAEhB,YAAY,CAACgB,QAAQ,CAAE,CAAAc,QAAA,eACrCnC,KAAA,QAAKkC,SAAS,CAAC,MAAM,CAAAC,QAAA,eACnBrC,IAAA,UAAOsC,OAAO,CAAC,UAAU,CAACF,SAAS,CAAC,4BAA4B,CAAAC,QAAA,CAAC,oBAAe,CAAO,CAAC,cACxFrC,IAAA,CAACL,UAAU,EACT4C,IAAI,CAAC,UAAU,CACfjC,OAAO,CAAEA,OAAQ,CACjBkC,YAAY,CAAC,EAAE,CACfC,MAAM,CAAEC,KAAA,MAAC,CAAEC,KAAM,CAAC,CAAAD,KAAA,oBAAK1C,IAAA,aAAW2C,KAAK,CAAEP,SAAS,CAAC,uFAAuF,CAACQ,WAAW,CAAC,qBAAqB,CAAE,CAAC,EAAC,CACjL,CAAC,EACC,CAAC,cACN1C,KAAA,QAAKkC,SAAS,CAAC,MAAM,CAAAC,QAAA,eACnBrC,IAAA,UAAOsC,OAAO,CAAC,UAAU,CAACF,SAAS,CAAC,4BAA4B,CAAAC,QAAA,CAAC,OAAK,CAAO,CAAC,cAC9ErC,IAAA,CAACL,UAAU,EACT4C,IAAI,CAAC,UAAU,CACfjC,OAAO,CAAEA,OAAQ,CACjBkC,YAAY,CAAC,EAAE,CACfC,MAAM,CAAEI,KAAA,MAAC,CAAEF,KAAM,CAAC,CAAAE,KAAA,oBAAK7C,IAAA,UAAOoB,IAAI,CAAC,UAAU,IAAKuB,KAAK,CAAEP,SAAS,CAAC,uFAAuF,CAACQ,WAAW,CAAC,kBAAkB,CAAE,CAAC,EAAC,CAC9L,CAAC,EACC,CAAC,cACN5C,IAAA,QAAAqC,QAAA,cACErC,IAAA,WAAQoB,IAAI,CAAC,QAAQ,CAACgB,SAAS,CAAC,yHAAyH,CAAAC,QAAA,CAAC,OAE1J,CAAQ,CAAC,CACN,CAAC,cACNnC,KAAA,QAAKkC,SAAS,CAAC,kBAAkB,CAAAC,QAAA,eAC/BrC,IAAA,SAAMoC,SAAS,CAAC,iBAAiB,CAAAC,QAAA,CAAC,wBAAmB,CAAM,CAAC,cAC5DrC,IAAA,WACEoB,IAAI,CAAC,QAAQ,CACbgB,SAAS,CAAC,sEAAsE,CAChFU,OAAO,CAAEA,CAAA,GAAMrC,QAAQ,CAAC,WAAW,CAAE,CAAA4B,QAAA,CACtC,cAED,CAAQ,CAAC,EACN,CAAC,EACF,CAAC,EACJ,CAAC,CACH,CAAC,CAEV,CAAC,CAED,cAAe,CAAAlC,SAAS","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}