{"ast":null,"code":"import React,{useEffect,useCallback}from'react';import{useForm,Controller}from'react-hook-form';import{useNavigate}from'react-router-dom';import useWebSocket from'../../api';import{useAuth}from'../../contexts/AuthContext';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const RegisterForm=_ref=>{let{api}=_ref;const{control,handleSubmit,getValues}=useForm();const navigate=useNavigate();const webScoket1=useWebSocket(process.env.REACT_APP_API_URL1);const webScoket2=useWebSocket(process.env.REACT_APP_API_URL2);const{login,isServersConnected,setConnect}=useAuth();const openNotificationWithIcon=useCallback((type,message,description)=>{api[type]({message,description});},[api]);const onSubmit=data=>{if(data.password!==data.confirmPassword){openNotificationWithIcon('error','Erro','As senhas não coincidem.');console.error('As senhas não coincidem.');return;}if(!data.username||!data.password){openNotificationWithIcon('error',\"Erro\",'Preencha todos os campos.');console.error('Preencha todos os campos.');return;}if(data.username.includes(' ')||data.password.includes(' ')){openNotificationWithIcon('error',\"Erro\",'Nome de usuário e senha não podem conter espaços.');console.error('Nome de usuário e não podem conter espaços.');return;}if(!webScoket1.checkConnection()){webScoket1.connectWebSocket();}if(!webScoket2.checkConnection()){webScoket2.connectWebSocket();}if(!webScoket1.checkConnection()&&!webScoket2.checkConnection()&&isServersConnected){setConnect(false);}else if((webScoket1.checkConnection()||webScoket2.checkConnection())&&!isServersConnected){setConnect(true);}webScoket1.send(\"/register \".concat(data.username,\" \").concat(data.password));webScoket2.send(\"/register \".concat(data.username,\" \").concat(data.password));};const handleWebSocketMessage=useCallback((message,username)=>{if(message.status==='success'){openNotificationWithIcon('success','Registro Bem-Sucedido','Você se registrou com sucesso!');login(username);navigate('/home');}else if(message.status==='error'){openNotificationWithIcon('error','Erro',message.data);console.error(message);}},[navigate,openNotificationWithIcon,login]);useEffect(()=>{if(webScoket1.receivedMessages){handleWebSocketMessage(webScoket1.receivedMessages,getValues().username);}},[webScoket1.receivedMessages,handleWebSocketMessage,getValues]);useEffect(()=>{if(webScoket2.receivedMessages){handleWebSocketMessage(webScoket2.receivedMessages,getValues().username);}},[webScoket2.receivedMessages,handleWebSocketMessage,getValues]);return/*#__PURE__*/_jsx(\"div\",{className:\"flex items-center justify-center min-h-screen bg-lightGray\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"w-full max-w-md p-8 bg-white shadow-lg rounded-lg\",children:[/*#__PURE__*/_jsx(\"h2\",{className:\"text-2xl font-bold mb-6 text-center\",children:\"Registro\"}),/*#__PURE__*/_jsxs(\"form\",{onSubmit:handleSubmit(onSubmit),children:[/*#__PURE__*/_jsxs(\"div\",{className:\"mb-4\",children:[/*#__PURE__*/_jsx(\"label\",{htmlFor:\"username\",className:\"block text-mediumGray mb-2\",children:\"Nome de usu\\xE1rio\"}),/*#__PURE__*/_jsx(Controller,{name:\"username\",control:control,defaultValue:\"\",render:_ref2=>{let{field}=_ref2;return/*#__PURE__*/_jsx(\"input\",{...field,className:\"w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary\",placeholder:\"Digite seu username\"});}})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"mb-4\",children:[/*#__PURE__*/_jsx(\"label\",{htmlFor:\"password\",className:\"block text-mediumGray mb-2\",children:\"Senha\"}),/*#__PURE__*/_jsx(Controller,{name:\"password\",control:control,defaultValue:\"\",render:_ref3=>{let{field}=_ref3;return/*#__PURE__*/_jsx(\"input\",{type:\"password\",...field,className:\"w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary\",placeholder:\"Digite sua senha\"});}})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"mb-4\",children:[/*#__PURE__*/_jsx(\"label\",{htmlFor:\"confirmPassword\",className:\"block text-mediumGray mb-2\",children:\"Confirmar senha\"}),/*#__PURE__*/_jsx(Controller,{name:\"confirmPassword\",control:control,defaultValue:\"\",render:_ref4=>{let{field}=_ref4;return/*#__PURE__*/_jsx(\"input\",{type:\"password\",...field,className:\"w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary\",placeholder:\"Confirme sua senha\"});}})]}),/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsx(\"button\",{type:\"submit\",className:\"w-full mt-2 px-4 py-2 bg-primary text-white rounded-lg hover:bg-green-500 focus:outline-none focus:ring-2 focus:ring-primary\",children:\"Register\"})}),/*#__PURE__*/_jsxs(\"div\",{className:\"mt-4 text-center\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"text-mediumGray\",children:\"J\\xE1 tem uma conta? \"}),/*#__PURE__*/_jsx(\"button\",{type:\"button\",className:\"text-primary hover:text-green-500 focus:outline-none focus:underline\",onClick:()=>navigate('/'),children:\"Fa\\xE7a login\"})]})]})]})});};export default RegisterForm;","map":{"version":3,"names":["React","useEffect","useCallback","useForm","Controller","useNavigate","useWebSocket","useAuth","jsx","_jsx","jsxs","_jsxs","RegisterForm","_ref","api","control","handleSubmit","getValues","navigate","webScoket1","process","env","REACT_APP_API_URL1","webScoket2","REACT_APP_API_URL2","login","isServersConnected","setConnect","openNotificationWithIcon","type","message","description","onSubmit","data","password","confirmPassword","console","error","username","includes","checkConnection","connectWebSocket","send","concat","handleWebSocketMessage","status","receivedMessages","className","children","htmlFor","name","defaultValue","render","_ref2","field","placeholder","_ref3","_ref4","onClick"],"sources":["/home/eduardo/repos/chat/chat-webapp/src/pages/Register/index.tsx"],"sourcesContent":["import React, { useEffect, useCallback } from 'react';\nimport { useForm, Controller } from 'react-hook-form';\nimport { useNavigate } from 'react-router-dom';\nimport useWebSocket from '../../api';\nimport { type NotificationInstance } from 'antd/es/notification/interface';\nimport { NotificationType } from '../../common/notificationType';\nimport { useAuth } from '../../contexts/AuthContext';\n\ninterface FormData {\n  username: string;\n  password: string;\n  confirmPassword: string;\n}\n\ninterface RegisterFormProps {\n  api: NotificationInstance;\n}\n\nconst RegisterForm: React.FC<RegisterFormProps> = ({ api }) => {\n  const { control, handleSubmit, getValues } = useForm<FormData>();\n  const navigate = useNavigate();\n    const webScoket1= useWebSocket( process.env.REACT_APP_API_URL1 as string);\n  const webScoket2 = useWebSocket( process.env.REACT_APP_API_URL2 as string);\n  const { login, isServersConnected, setConnect } = useAuth();\n\n  const openNotificationWithIcon = useCallback(\n    (type: NotificationType, message: string, description: string) => {\n      api[type]({\n        message,\n        description,\n      });\n    },\n    [api]\n  );\n\n  const onSubmit = (data: FormData) => {\n    if (data.password !== data.confirmPassword) {\n      openNotificationWithIcon('error', 'Erro', 'As senhas não coincidem.');\n      console.error('As senhas não coincidem.');\n      return;\n    }\n\n    if (!data.username || !data.password) {\n      openNotificationWithIcon('error', \"Erro\", 'Preencha todos os campos.');\n      console.error('Preencha todos os campos.');\n      return;\n    }\n\n    if (data.username.includes(' ') || data.password.includes(' ')) {\n      openNotificationWithIcon('error', \"Erro\", 'Nome de usuário e senha não podem conter espaços.');\n      console.error('Nome de usuário e não podem conter espaços.');\n      return;\n    }\n\n    if (!webScoket1.checkConnection()){\n      webScoket1.connectWebSocket();\n    }\n    if (!webScoket2.checkConnection()){\n      webScoket2.connectWebSocket();\n    }\n\n    if (!webScoket1.checkConnection() && !webScoket2.checkConnection() && isServersConnected) {\n      setConnect(false);\n    } else if ((webScoket1.checkConnection() || webScoket2.checkConnection()) && !isServersConnected) {\n      setConnect(true)\n    }\n    webScoket1.send(`/register ${data.username} ${data.password}`);\n    webScoket2.send(`/register ${data.username} ${data.password}`);\n  };\n\n  const handleWebSocketMessage = useCallback(\n    (message: any, username: string) => {\n      if (message.status === 'success') {\n        openNotificationWithIcon('success', 'Registro Bem-Sucedido', 'Você se registrou com sucesso!')\n        login(username);\n        navigate('/home');\n      } else if (message.status === 'error') {\n        openNotificationWithIcon('error', 'Erro', message.data);\n        console.error(message);\n      }\n    },\n    [navigate, openNotificationWithIcon, login]\n  );\n\n  useEffect(() => {\n    if (webScoket1.receivedMessages) {\n      handleWebSocketMessage(webScoket1.receivedMessages, getValues().username);\n    }\n  }, [webScoket1.receivedMessages, handleWebSocketMessage, getValues]);\n\n  useEffect(() => {\n    if (webScoket2.receivedMessages) {\n      handleWebSocketMessage(webScoket2.receivedMessages, getValues().username);\n    }\n  }, [webScoket2.receivedMessages, handleWebSocketMessage, getValues]);\n\n  return (\n    <div className=\"flex items-center justify-center min-h-screen bg-lightGray\">\n      <div className=\"w-full max-w-md p-8 bg-white shadow-lg rounded-lg\">\n        <h2 className=\"text-2xl font-bold mb-6 text-center\">Registro</h2>\n        <form onSubmit={handleSubmit(onSubmit)}>\n          <div className=\"mb-4\">\n            <label htmlFor=\"username\" className=\"block text-mediumGray mb-2\">Nome de usuário</label>\n            <Controller\n              name=\"username\"\n              control={control}\n              defaultValue=\"\"\n              render={({ field }) => <input {...field} className=\"w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary\" placeholder=\"Digite seu username\" />}\n            />\n          </div>\n          <div className=\"mb-4\">\n            <label htmlFor=\"password\" className=\"block text-mediumGray mb-2\">Senha</label>\n            <Controller\n              name=\"password\"\n              control={control}\n              defaultValue=\"\"\n              render={({ field }) => <input type=\"password\" {...field} className=\"w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary\" placeholder=\"Digite sua senha\" />}\n            />\n          </div>\n          <div className=\"mb-4\">\n            <label htmlFor=\"confirmPassword\" className=\"block text-mediumGray mb-2\">Confirmar senha</label>\n            <Controller\n              name=\"confirmPassword\"\n              control={control}\n              defaultValue=\"\"\n              render={({ field }) => <input type=\"password\" {...field} className=\"w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary\" placeholder=\"Confirme sua senha\" />}\n            />\n          </div>\n          <div>\n            <button type=\"submit\" className=\"w-full mt-2 px-4 py-2 bg-primary text-white rounded-lg hover:bg-green-500 focus:outline-none focus:ring-2 focus:ring-primary\">\n              Register\n            </button>\n          </div>\n          <div className=\"mt-4 text-center\">\n            <span className=\"text-mediumGray\">Já tem uma conta? </span>\n            <button\n              type=\"button\"\n              className=\"text-primary hover:text-green-500 focus:outline-none focus:underline\"\n              onClick={() => navigate('/')}\n            >\n              Faça login\n            </button>\n          </div>\n        </form>\n      </div>\n    </div>\n  );\n};\n\nexport default RegisterForm;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}